<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>HAPPY BIRTHDAY ASTHAA üíñ</title>
<style>
  @import url('https://fonts.googleapis.com/css2?family=Agbalumo&display=swap');

  :root {
    --pink: #ff6f91;
    --light-pink: #ff9a9e;
    --dark-pink: #b83b5e;
    --background: #fff0f6;
    --font-primary: 'Poppins', sans-serif;
    --font-cursive: 'Parisienne', cursive;
  }

  * {
    box-sizing: border-box;
  }

  body, html {
    margin: 0;
    padding: 0;
    background: var(--background);
    font-family: var(--font-primary);
    color: var(--dark-pink);
    height: 100vh;
    overflow: hidden;
    cursor: none;
  }

  /* Custom emoji cursor */
  #custom-cursor {
    position: fixed;
    top: 0;
    left: 0;
    font-size: 28px;
    pointer-events: none;
    user-select: none;
    z-index: 2000;
    transform: translate(-50%, -50%);
    transition: none;
    white-space: nowrap;
  }

  .container {
    position: relative;
    width: 100vw;
    height: 100vh;
  }

  .page {
    position: absolute;
    width: 100%;
    height: 100%;
    padding: 2rem 1.5rem 4rem 1.5rem;
    background: white;
    border-radius: 15px;
    box-shadow: 0 10px 30px rgba(184,59,94,0.2);
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    opacity: 0;
    pointer-events: none;
    transform: scale(0.95);
    transition: opacity 0.8s ease, transform 0.8s ease;
    overflow-y: auto;
  }

  .page.active {
    opacity: 1;
    pointer-events: all;
    transform: scale(1);
  }

  .fade-out {
    opacity: 0 !important;
    transform: scale(0.95) !important;
  }
  .fade-in {
    opacity: 1 !important;
    transform: scale(1) !important;
  }

  h1 {
    font-family: var(--font-cursive);
    font-size: 3.5rem;
    margin-bottom: 0.25rem;
    color: var(--pink);
  }

  h2 {
    font-weight: 600;
    color: var(--dark-pink);
    margin-bottom: 1.5rem;
  }

  p {
    font-size: 1.25rem;
    max-width: 600px;
    line-height: 1.6;
    text-align: center;
    margin-bottom: 2.5rem;
  }

  button {
    background: var(--pink);
    border: none;
    color: white;
    font-weight: 600;
    font-size: 1rem;
    padding: 0.75rem 1.75rem;
    border-radius: 50px;
    cursor: pointer;
    box-shadow: 0 6px 12px rgba(255,111,145,0.5);
    transition: background 0.3s ease, transform 0.2s ease;
  }

  button:hover:not(:disabled) {
    background: var(--dark-pink);
    transform: scale(1.05);
  }

  button:disabled {
    background: #f1b8c9;
    cursor: default;
    box-shadow: none;
    transform: none;
  }

  .nav-buttons {
    position: absolute;
    bottom: 1.5rem;
    width: 100%;
    display: flex;
    justify-content: space-between;
    padding: 0 2rem;
  }

  img.couple-photo {
    width: 280px;
    border-radius: 20px;
    box-shadow: 0 8px 20px rgba(184,59,94,0.15);
    margin-bottom: 2rem;
    user-select: none;
  }

  #game-box {
    width: 320px;
    height: 280px;
    border: 3px solid var(--pink);
    border-radius: 15px;
    position: relative;
    background: #fff0f6;
    box-shadow: inset 0 8px 20px rgba(184,59,94,0.1);
    user-select: none;
    margin-bottom: 1.5rem;
  }

  #hamster {
    position: absolute;
    width: 60px;
    height: 60px;
    cursor: pointer;
    user-select: none;
    border-radius: 50%;
    box-shadow: 0 5px 15px rgba(184,59,94,0.3);
    transition: transform 0.15s ease;
  }
    .hamster {
    transition: transform 0.2s ease;
    }

    .hamster:hover {
    transform: scale(1.2);
    transition: transform 0.2s ease;
    }

    .hamster:active {
    transform: scale(0.8);
    }

  
  #score-board {
    font-size: 1.4rem;
    font-weight: 700;
    color: var(--pink);
    margin-bottom: 0.8rem;
  }

  #confetti-canvas {
    position: fixed;
    top: 0;
    left: 0;
    width: 100vw;
    height: 100vh;
    pointer-events: none;
    z-index: 1000;
  }

  #mute-btn {
    position: fixed;
    top: 1rem;
    right: 1rem;
    background: var(--pink);
    color: white;
    border: none;
    border-radius: 50%;
    width: 48px;
    height: 48px;
    cursor: pointer;
    font-size: 1.4rem;
    box-shadow: 0 6px 12px rgba(255,111,145,0.5);
    display: flex;
    align-items: center;
    justify-content: center;
    transition: background 0.3s ease;
    z-index: 1100;
  }

  #mute-btn:hover {
    background: var(--dark-pink);
  }

  #lotus-container {
    position: fixed;
    top: 0;
    left: 0;
    width: 100vw;
    height: 100vh;
    pointer-events: none;
    z-index: 1050;
    font-size: 36px;
  }

  .lotus {
    position: absolute;
    opacity: 0;
    transform: scale(0) rotate(0deg);
    transition: opacity 0.6s ease, transform 0.6s ease;
    will-change: opacity, transform;
    user-select: none;
    line-height: 1;
  }

  .lotus.visible {
    opacity: 1;
    transform: scale(1) rotate(360deg);
  }

  .lotus.top-left { top: 12vh; left: 12vw; }
  .lotus.top-right { top: 15vh; right: 14vw; }
  .lotus.bottom-right { bottom: 14vh; right: 16vw; }
  .lotus.bottom-left { bottom: 12vh; left: 14vw; }
  .lotus.top-left-alt { top: 20vh; left: 18vw; }
  .lotus.top-right-alt { top: 22vh; right: 20vw; }
  .lotus.bottom-right-alt { bottom: 20vh; right: 22vw; }
  .lotus.bottom-left-alt { bottom: 18vh; left: 18vw; }

  /* Photo Gallery Styles */
  #photo-gallery {
    width: 100%;
    max-width: 100%;
    padding: 0 24px;
    margin: 0 auto;
    overflow-y: auto;
    padding-right: 0 12px;
    box-sizing: border-box;
  }
  #photo-gallery h2 {
    margin-bottom: 1rem;
    text-align: center;
    font-family: var(--font-cursive);
    font-size: 3rem;
    color: var(--pink);
  }

  .gallery-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
    grid-gap: 18px;
    box-sizing: border-box;
  }

  .gallery-item {
    border-radius: 15px;
    overflow: hidden;
    position: relative;
    box-shadow: 0 8px 15px rgba(184,59,94,0.15);
    cursor: pointer;
    transition: transform 0.3s ease;
  }

  .gallery-item:hover {
   transform: scale(1.05);
  }


  .gallery-item img {
    width: 100%;
    height: 100%;
    object-fit: cover;
    display: block;
  }

  /* Collage container uses CSS grid with spanning items */
  .collage {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    grid-template-rows: 150px 150px;
    gap: 18px;
    margin-top: 2rem;
    padding: 0 10px;
    box-sizing: border-box;
  }
  .collage-item {
    border-radius: 15px;
    overflow: hidden;
    box-shadow: 0 8px 15px rgba(184,59,94,0.15);
    cursor: pointer;
    transition: transform 0.3s ease;
  }
  .collage-item:hover {
    transform: scale(1.05);
    box-shadow: 0 10px 30px rgba(184,59,94,0.35);
  }
  .collage-item img {
    width: 100%;
    height: 100%;
    object-fit: cover;
    display: block;
    object-position: center;
  }
  /* Example of collage item spanning multiple columns or rows */
  .span-2-col {
    grid-column: span 2;
  }
  .span-2-row {
    grid-row: span 2;
  }

  /* Responsive adjustments */
  @media (max-width: 480px) {
    #photo-gallery {
      width: 95%;
      padding: 0 16px;
    }
    .gallery-grid {
    grid-gap: 14px;
    }
    .collage {
      grid-template-columns: repeat(2, 1fr);
      grid-template-rows: 120px 120px 120px 120px;
    }
    .span-2-col {
      grid-column: span 2;
    }
    .span-2-row {
      grid-row: span 2;
    }
  }

    #response-buttons {
    display: flex;
    gap: 20px; /* Space between buttons */
  }

  #response-buttons button {
    padding: 0.75rem 1.5rem;
    border-radius: 50px;
    background: var(--pink);
    color: white;
    border: none;
    font-size: 1rem;
    cursor: pointer;
    transition: transform 0.2s ease, background 0.3s ease;
  }

  #response-buttons button:hover {
    background: var(--dark-pink);
  } 

  /* Modal Styles */
  #image-modal {
    position: fixed;
    top: 0; left: 0; width: 100vw; height: 100vh;
    display: flex;
    align-items: center;
    justify-content: center;
    z-index: 1500;
    background: rgba(0, 0, 0, 0.7);
    cursor: zoom-out;
  }

  #modal-content {
    position: relative;
    width: 60%; /* Set a smaller width for the modal */
    max-width: 400px; /* Maximum width */
    background: white; /* Background color for the modal */
    border-radius: 10px; /* Rounded corners */
    box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3); /* Shadow for depth */
    padding: 10px; /* Padding inside the modal */
  }

  #modal-content img {
    width: 100%; /* Make the image responsive */
    height: auto; /* Maintain aspect ratio */
    border-radius: 5px; /* Rounded corners for the image */
    max-height: 95vh;
  }

  #modal-close {
    position: absolute;
    top: -12px;
    right: -12px;
    background: var(--pink);
    color: white;
    border: none;
    border-radius: 50%;
    width: 36px;
    height: 36px;
    font-size: 20px;
    cursor: pointer;
    box-shadow: 0 5px 15px rgba(184,59,94,0.3);
    transition: background 0.3s ease;
    z-index: 10;

    display: flex;
    align-items: center;
    justify-content: center;
    padding: 0;
    line-height: 1;
  }


  #modal-close:hover {
    background: var(--dark-pink);
    transform: scale(1.1);
  }
  #celebration-page h1 {
    text-align: right;
    margin-right: -5rem;
  }
</style>
</head>
<body>
  <!-- Custom cursor -->
  <div id="custom-cursor" aria-hidden="true">üêπ</div>

  <div class="container">

    <!-- Page 1: Welcome -->
    <section class="page active" id="page-1" aria-label="Welcome Page">
      <h1>HAPPY BIRTHDAY, ASTHAAA! üíñ</h1>
      <img src="assests/images/valentines.jpg" alt="Couple photo" class="couple-photo" />
      <p>
        It's your day shine like the very STAR you areüåü. You light up my life every day and I'll always cherish you. <br>
      </p>
    </section>

    <!-- Page 2: Sweet message -->
    <section class="page" id="page-2" aria-label="Sweet Message">
      <h2>To My Beautiful Girlfriend...</h2>
      <p>
        HIIIIIIIII BEAUTIFUL, first of all HAPPPPYYY BIRTHDAYYYY, it's your day shine like the ever-bright star you have been in my life. I know humme mille hue zada time nhi hua hai, not even a year but still tumne jo meri life me ENTRYY maari hai it has changed my life‚Ä¶ for the better ofcc, tumhara tokna for my bad habits, kbhi kbhi randomly itne freaky and jubilant ho jaana, the random giggles, random pitaya hehehhe and the mischievous-person behind thattt adorableeeeee smile, I love every inch of you‚Ä¶ you are perfect the way you are‚Ä¶ you are perfect for me‚Ä¶ kbhi mat sochna ki me iske liye buri toh nhi cuz some DUMB log said somethings. I adore you; I respect you‚Ä¶ I Love You!!!! Pehli meri favourite sound thi rain failing on tin roofs but mujhe kya pata tha ki ek 5'3" piddi aaegi mere jeevan me jo uski laugh meri favourite sound/song sab bana degi. Aur chapad chapad krte rha kro‚Ä¶ bohot maza aata hai tumse baat krne meüëâüëà.<br>
        YOU ARE MY FAVOURITE PERSON!!!!<br>
        ILYSSSSMMMMM XOXO
      </p>
    </section>

    <!-- New Page 3: Photo Gallery with Collage -->
    <section class="page" id="page-3" aria-label="Photo Gallery">
    <div id="photo-gallery" tabindex="0">
    <h2>Our Memories Together</h2>
    <div class="gallery-grid" aria-label="Photo gallery">
      <!-- Single images -->
      <div class="gallery-item"><img src="assests/images/lightshow.jpg" alt="Memory 1" class="gallery-img"></div>
      <div class="gallery-item"><img src="assests/images/cutieeee.jpg" alt="Memory 2" class="gallery-img"></div>
      <div class="gallery-item"><img src="assests/images/handnaaping.jpg" alt="Memory 3" class="gallery-img"></div>
      <div class="gallery-item"><img src="assests/images/fireworks.jpg" alt="Memory 4" class="gallery-img"></div>
      <div class="gallery-item"><img src="assests/images/loredropping.jpg" alt="Memory 5" class="gallery-img"></div>
      <div class="gallery-item"><img src="assests/images/Holi.jpg" alt="Memory 6" class="gallery-img"></div>
    </div>
    <div class="collage" aria-label="Photo collage">
      <!-- Collage images with different spans -->
      <div class="collage-item span-2-row"><img src="assests/images/birthdayvali.jpg" alt="Collage 1" class="gallery-img" style="object-position: top;"></div>
      <div class="collage-item"><img src="assests/images/bikeride.jpg" alt="Collage 2" class="gallery-img"></div>
      <div class="collage-item span-2-row"><img src="assests/images/jij.jpg" alt="Collage 3" class="gallery-img" style="object-position: bottom;"></div>
      <div class="collage-item"><img src="assests/images/metrotokens.jpg" alt="Collage 4" class="gallery-img"></div>
    </div>
    </div>
    <!-- Modal for displaying the clicked image -->
    <div id="image-modal" style="display: none;">
    <div id="modal-overlay"></div>
    <div id="modal-content">
      <button id="modal-close">‚úñ</button>
      <img id="modal-image" src="" alt="Large view" />
    </div>
  </div>
</section>

    <!-- Page 4: Hamster Catching Game -->
    <section class="page" id="page-4" aria-label="Hamster Catching Game">
      <h2>Huzz's Hamster Hunt!üêπ</h2>
      <div id="score-board" aria-live="polite" aria-atomic="true">Score: 0</div>
      <div id="game-box" role="region" aria-label="Hamster catching game area" tabindex="0"></div>
      <p>
        Task: Collect 10 hamsters<br>
        Click on the hamsters that randomly appear to catch them! 
      </p>
    </section>

      <!-- Page 5: Final Wishes -->
      <section class="page" id="page-5" aria-label="Final Wishes" style="display:none;">
      <h1 id="final-question">Will you be my Huzz??üëâüëà</h1>
      <img id="question-image" src="assests/images/q1.jpg" alt="Question Image" />
      <div id="response-buttons">
      <button id="yes-btn">Yes</button>
      <button id="no-btn">No</button>

      <div id="lotus-container" aria-hidden="true">
        <div class="lotus top-left">ü™∑</div>
        <div class="lotus top-left-alt">ü™∑</div>
        <div class="lotus top-right">ü™∑</div>
        <div class="lotus top-right-alt">ü™∑</div>
        <div class="lotus bottom-right">ü™∑</div>
        <div class="lotus bottom-right-alt">ü™∑</div>
        <div class="lotus bottom-left">ü™∑</div>
        <div class="lotus bottom-left-alt">ü™∑</div>
      </div>
    </section>

    <!-- Celebration Page -->
  <section class="page" id="celebration-page" style="display:none;">
    <h1>Yayyyy! üéâ</h1>
    <img src="assests/images/qr.png" alt="QR Code" style="width: 200px; height: auto;"/>
    <p>Scan the QR code for a surprise!</p>
  </section>

    <nav class="nav-buttons" aria-label="Page navigation">
      <button id="prevBtn" disabled aria-disabled="true" aria-label="Previous page">‚Üê Previous</button>
      <button id="nextBtn" aria-label="Next page">Next ‚Üí</button>
    </nav>
  </div>

  <audio id="bg-music" src="assests/music/lostwoods-kalimba.mp3" loop autoplay></audio>
  <button id="mute-btn" aria-label="Toggle music mute" title="Mute / Unmute music">üîà</button>
  <canvas id="confetti-canvas"></canvas>

  <script>
    (function() {
      const customCursor = document.getElementById('custom-cursor');
      const buttons = document.querySelectorAll('button');
      let currentEmoji = 'üêπ';

      // Follow mouse position
      window.addEventListener('mousemove', e => {
        customCursor.style.left = `${e.clientX}px`;
        customCursor.style.top = `${e.clientY}px`;
      });

      // Change emoji on button hover
      buttons.forEach(button => {
        button.addEventListener('mouseenter', () => {
          currentEmoji = 'üíñ';
          customCursor.textContent = currentEmoji;
        });
        button.addEventListener('mouseleave', () => {
          currentEmoji = 'üêπ';
          customCursor.textContent = currentEmoji;
        });
      });

      const pages = document.querySelectorAll('.page');
      const prevBtn = document.getElementById('prevBtn');
      const nextBtn = document.getElementById('nextBtn');

      let currentPage = 0;
      let gameCompleted = false;

      function showPage(index) {
        pages.forEach((page, idx) => {
          if(idx === index) {
            page.classList.add('active');
            if(page.style.display === 'none') page.style.display = '';
          } else {
            page.classList.remove('active');
          }
        });
        
        prevBtn.disabled = index === 0;
        prevBtn.setAttribute('aria-disabled', index === 0 ? 'true' : 'false');

        // Disable next on game page if not completed
        if(index === 3 && !gameCompleted) {
          nextBtn.disabled = true;
          nextBtn.setAttribute('aria-disabled', 'true');
        } else {
          nextBtn.disabled = index === pages.length - 1;
          nextBtn.setAttribute('aria-disabled', (index === pages.length - 1) ? 'true' : 'false');
        }
      }

      prevBtn.addEventListener('click', () => {
        if(currentPage > 0) {
          currentPage--;
          showPage(currentPage);
          if(currentPage === 3 && !gameCompleted) {
            startGame();
            stopConfetti();
            stopLotus();
          } else {
            stopConfetti();
            stopLotus();
          }
        }
      });

      nextBtn.addEventListener('click', () => {
        if(currentPage < pages.length -1 && (currentPage !== 3 || gameCompleted)) {
          currentPage++;
          showPage(currentPage);
          if(currentPage === 3 && !gameCompleted) {
            startGame();
            stopConfetti();
            stopLotus();
          } else {
            stopConfetti();
            stopLotus();
          }
        }
      });

      showPage(currentPage);

      const gameBox = document.getElementById('game-box');
      const scoreBoard = document.getElementById('score-board');
      const hamsterSrc = "assests/images/hamster.png";

      let hamsterElement = null;
      let gameInterval = null;
      let score = 0;
      const maxScore = 10;

      function createHamster() {
        if(hamsterElement) hamsterElement.remove();
        hamsterElement = document.createElement('img');
        hamsterElement.src = hamsterSrc;
        hamsterElement.alt = 'Hamster';
        hamsterElement.id = 'hamster';
        hamsterElement.tabIndex = 0;
        hamsterElement.role = 'button';
        hamsterElement.setAttribute('aria-label','Clickable hamster to catch');
        hamsterElement.style.position = 'absolute';

        const boxRect = gameBox.getBoundingClientRect();
        const boxWidth = boxRect.width;
        const boxHeight = boxRect.height;
        const hamWidth = 60;
        const hamHeight = 60;

        let top = Math.random() * (boxHeight - hamHeight);
        let left = Math.random() * (boxWidth - hamWidth);

        hamsterElement.style.top = `${top}px`;
        hamsterElement.style.left = `${left}px`;
        hamsterElement.style.width = `${hamWidth}px`;
        hamsterElement.style.height = `${hamHeight}px`;

        hamsterElement.addEventListener('click', catchHamster);
        hamsterElement.addEventListener('keypress', e => {
          if(e.key === 'Enter' || e.key === ' ') {
            e.preventDefault();
            catchHamster();
          }
        });

        gameBox.appendChild(hamsterElement);
      }

      function catchHamster() {
        if(gameCompleted) return;
        hamsterElement.style.transform = 'scale(1.3)';
        setTimeout(() => {
          if(hamsterElement) hamsterElement.style.transform = 'scale(1)';
        }, 150);

        score++;
        scoreBoard.textContent = `Score: ${score}`;

        if(score >= maxScore){
          fadeTransitionToFinal();
        }
      }

      function moveHamster(){
        if(gameCompleted) return;
        if(!hamsterElement){
          createHamster();
        } else {
          const boxRect = gameBox.getBoundingClientRect();
          const boxWidth = boxRect.width;
          const boxHeight = boxRect.height;
          const hamWidth = 60;
          const hamHeight = 60;

          let top = Math.random() * (boxHeight - hamHeight);
          let left = Math.random() * (boxWidth - hamWidth);

          hamsterElement.style.top = `${top}px`;
          hamsterElement.style.left = `${left}px`;
        }
      }

      function startGame(){
        score = 0;
        gameCompleted = false;
        scoreBoard.textContent = `Score: ${score}`;
        createHamster();
        gameInterval = setInterval(moveHamster, 1200);
      }

      function fadeTransitionToFinal(){
        gameCompleted = true;
        if(gameInterval){
          clearInterval(gameInterval);
          gameInterval = null;
        }

        const gamePage = document.getElementById('page-4');
        const finalPage = document.getElementById('page-5');

        gamePage.classList.add('fade-out');
        gamePage.addEventListener('transitionend', function onTransition(e) {
          if(e.propertyName === 'opacity'){
            gamePage.removeEventListener('transitionend', onTransition);

            gamePage.style.display = 'none';
            gamePage.classList.remove('fade-out', 'active');

            // Show final page
            finalPage.style.display = 'flex';
            requestAnimationFrame(() => {
              finalPage.classList.add('active', 'fade-in');
              finalPage.addEventListener('transitionend', function onFadeIn(e2){
                if(e2.propertyName === 'opacity'){
                  finalPage.removeEventListener('transitionend', onFadeIn);
                  finalPage.classList.remove('fade-in');
                }
              });
            });

            prevBtn.disabled = false;
            prevBtn.setAttribute('aria-disabled', 'false');
            nextBtn.disabled = true;
            nextBtn.setAttribute('aria-disabled', 'true');

            currentPage = 4;

            startConfetti();
            startLotus();
          }
        });
      }

      const lotusContainer = document.getElementById('lotus-container');
      const lotusElements = Array.from(lotusContainer.querySelectorAll('.lotus'));
      let lotusInterval = null;

      function startLotus(){
        let index = 0;
        lotusElements.forEach(lotus => lotus.classList.remove('visible'));
        lotusInterval = setInterval(() => {
          if(index >= lotusElements.length){
            clearInterval(lotusInterval);
            lotusInterval = null;
            return;
          }
          lotusElements[index].classList.add('visible');
          index++;
        }, 400);
      }

      function stopLotus(){
        if(lotusInterval){
          clearInterval(lotusInterval);
          lotusInterval = null;
        }
        lotusElements.forEach(lotus => lotus.classList.remove('visible'));
      }

      function checkGameStart(){
        if(currentPage === 3 && !gameCompleted){
          startGame();
          stopConfetti();
          stopLotus();
        }
      }
      checkGameStart();

      const confettiCanvas = document.getElementById('confetti-canvas');
      const ctx = confettiCanvas.getContext('2d');
      let confettiPieces = [];
      let confettiAnimationId = null;
      let confettiTimeoutId = null;
      let fadingOut = false;
      const fadeOutDuration = 4000;

      function resizeCanvas(){
        confettiCanvas.width = window.innerWidth;
        confettiCanvas.height = window.innerHeight;
      }
      window.addEventListener('resize', resizeCanvas);
      resizeCanvas();

      class ConfettiPiece {
        constructor(){
          this.x = Math.random() * confettiCanvas.width;
          this.y = Math.random() * confettiCanvas.height - confettiCanvas.height;
          this.size = Math.random() * 8 + 6;
          this.speed = Math.random() * 3 + 2;
          this.rotation = Math.random() * 360;
          this.rotationSpeed = Math.random() * 10 + 5;
          this.color = `hsl(${Math.random() * 60 + 320}, 70%, 60%)`;
          this.shape = Math.random() > 0.5 ? 'circle' : 'rect';
          this.opacity = 1;
        }
        update(){
          this.y += this.speed;
          this.rotation += this.rotationSpeed;
          if(this.y > confettiCanvas.height){
            this.y = -this.size;
            this.x = Math.random() * confettiCanvas.width;
          }
          if(fadingOut){
            this.opacity -= 1/(fadeOutDuration/16.67);
            this.opacity = Math.max(this.opacity, 0);
          }
        }
        draw(ctx){
          if(this.opacity <= 0) return;
          ctx.save();
          ctx.globalAlpha = this.opacity;
          ctx.translate(this.x, this.y);
          ctx.rotate((this.rotation * Math.PI)/180);
          ctx.fillStyle = this.color;
          if(this.shape === 'circle'){
            ctx.beginPath();
            ctx.arc(0, 0, this.size/2, 0, 2*Math.PI);
            ctx.fill();
          } else {
            ctx.fillRect(-this.size/2, -this.size/2, this.size, this.size);
          }
          ctx.restore();
        }
      }

      function createConfetti(num){
        confettiPieces = [];
        for(let i=0; i<num; i++){
          confettiPieces.push(new ConfettiPiece());
        }
      }

      function animateConfetti(){
        ctx.clearRect(0, 0, confettiCanvas.width, confettiCanvas.height);
        let activePieces = 0;
        confettiPieces.forEach(piece => {
          piece.update();
          piece.draw(ctx);
          if(piece.opacity > 0) activePieces++;
        });
        if(activePieces > 0){
          confettiAnimationId = requestAnimationFrame(animateConfetti);
        } else {
          cancelAnimationFrame(confettiAnimationId);
          confettiAnimationId = null;
          ctx.clearRect(0, 0, confettiCanvas.width, confettiCanvas.height);
          fadingOut = false;
        }
      }

      function startConfetti(){
        fadingOut = false;
        createConfetti(100);
        if(!confettiAnimationId){
          animateConfetti();
        }
        if(confettiTimeoutId){
          clearTimeout(confettiTimeoutId);
        }
        confettiTimeoutId = setTimeout(() => {
          startFadeOutConfetti();
        }, 4000);
      }

      function startFadeOutConfetti(){
        fadingOut = true;
      }

      function stopConfetti(){
        fadingOut = false;
        if(confettiAnimationId){
          cancelAnimationFrame(confettiAnimationId);
          confettiAnimationId = null;
          ctx.clearRect(0, 0, confettiCanvas.width, confettiCanvas.height);
        }
        if(confettiTimeoutId){
          clearTimeout(confettiTimeoutId);
          confettiTimeoutId = null;
        }
      }

      const bgMusic = document.getElementById('bg-music');
      const muteBtn = document.getElementById('mute-btn');

      bgMusic.muted = false;

      function updateMuteButton(){
        if(bgMusic.muted){
          muteBtn.textContent = 'üîá';
          muteBtn.title = 'Unmute music';
          muteBtn.setAttribute('aria-label', 'Unmute music');
        } else {
          muteBtn.textContent = 'üîà';
          muteBtn.title = 'Mute music';
          muteBtn.setAttribute('aria-label', 'Mute music');
        }
      }

      muteBtn.addEventListener('click', ()=>{
        bgMusic.muted = !bgMusic.muted;
        updateMuteButton();
      });

      updateMuteButton();
    })();

    const finalQuestion = document.getElementById('final-question');
    const yesButton = document.getElementById('yes-btn');
    const noButton = document.getElementById('no-btn');
    const questionImage = document.getElementById('question-image');

    let noClickCount = 0;
    let swapped = false; // Track if buttons' functions are swapped

    // Helper functions for Yes and No clicks
    function normalYesAction() {
      transitionToCelebrationPage();
    }

    function normalNoAction() {
      noClickCount++;
      if (noClickCount === 1) {
        finalQuestion.textContent = "Are you sure?";
        questionImage.src = "assests/images/q2.jpg"; // update as needed
        swapped = true; // swap button functions from now on
      } else if (noClickCount === 2) {
          finalQuestion.textContent = "ARE YOU SURE SURE??";
          questionImage.src = "assests/images/q3.jpg"; // update as needed
      } else {
          finalQuestion.textContent = "I knew you were joking!";
          yesButton.textContent = "Yes"; // reset label if changed
          noBtnNew.style.display = 'none'; // hide the *new* no button
          questionImage.src = "assests/images/q4.jpg"; // update as needed
          noClickCount = 0;
        swapped = false; // reset swap for next round if applicable
      }
    }

    function swappedYesAction() {
      normalNoAction();
    }

    function swappedNoAction() {
      transitionToCelebrationPage();
    }

    // Clear previous event listeners (if reattaching)
    yesButton.replaceWith(yesButton.cloneNode(true));
    noButton.replaceWith(noButton.cloneNode(true));

    const yesBtnNew = document.getElementById('yes-btn');
    const noBtnNew = document.getElementById('no-btn');

    function attachEventListeners() {
      yesBtnNew.onclick = () => {
        if (!swapped) normalYesAction();
        else swappedYesAction();
      };

      noBtnNew.onclick = () => {
        if (!swapped) normalNoAction();
        else swappedNoAction();
      };
    }

    // Initial attach
    attachEventListeners();

    // Transition to celebration page function remains unchanged
    function transitionToCelebrationPage() {
      const celebrationPage = document.createElement('section');
      celebrationPage.className = 'page';
      celebrationPage.id = 'celebration-page';
      celebrationPage.innerHTML = `
      <h1>Yayyyy! üéâ</h1>
      <img src="assests/images/qr.png" alt="QR Code" style="width: 200px; height: auto;"/>
      <p>Scan the QR code for a surprise!</p>
      `;
      document.querySelector('.container').appendChild(celebrationPage);
      celebrationPage.classList.add('active');
      celebrationPage.style.display = 'flex';

      document.getElementById('page-5').style.display = 'none';
    }

    // Get modal elements
    const imageModal = document.getElementById('image-modal');
    const modalImage = document.getElementById('modal-image');
    const modalClose = document.getElementById('modal-close');

    // Add click event to all gallery images
    const galleryImages = document.querySelectorAll('.gallery-img');
    galleryImages.forEach(image => {
    image.addEventListener('click', () => {
      modalImage.src = image.src; // Set the modal image source to the clicked image
      imageModal.style.display = 'flex'; // Show the modal
    });
    });

    // Close modal when close button is clicked
    modalClose.addEventListener('click', () => {
      imageModal.style.display = 'none'; // Hide the modal
    });

    // Close modal when clicking outside the image
    document.getElementById('modal-overlay').addEventListener('click', () => {
      imageModal.style.display = 'none'; // Hide the modal
  });


  </script>
</body>
</html>